<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nam-Anh Tran">

<title>BIOS602: Assignment 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="assignment1S_files/libs/clipboard/clipboard.min.js"></script>
<script src="assignment1S_files/libs/quarto-html/quarto.js"></script>
<script src="assignment1S_files/libs/quarto-html/popper.min.js"></script>
<script src="assignment1S_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="assignment1S_files/libs/quarto-html/anchor.min.js"></script>
<link href="assignment1S_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="assignment1S_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="assignment1S_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="assignment1S_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="assignment1S_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">BIOS602: Assignment 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nam-Anh Tran </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Which of these questions remain relevant today? Are any of them outdated?
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>THE EXPERIMENTAL UNITS</strong></p>
<ol type="1">
<li><p><em>(Q1) Is what you plan truly an experiment?</em> This question still plays a crucial role since the presence of randomization in the study strongly affects the bias of the statistical results, especially, causal inferences. Once the randomization presents, no longer is the confounding issue to draw the causal effect relationship. In contrast, more statistical approaches are required to attenuate the bias caused mainly by confounding.</p></li>
<li><p><em>(Q2) Why do the experiment? (Q11) What are the objectives and priorities?</em> These questions relate to the objective question of any study that researchers have to contemplate when they start their studies. In other words, this is the hypotheses of interest that require to be tested through studies. These questions are still important and worth considering.</p></li>
<li><p><em>(Q3) What experimental unit is to be used? (Q4) Are units ``of equal size‚Äù?</em> These questions are also important when we collect data (sampling techniques) or consider statistical methods to analyse the collected data. Unintentionally, this question often arises as a moot point in discussions between statisticians and experts in the field (biologist, clinicians, etc.) since once experimental unit is specified incorrectly, it leads to incorrect analyses, and hence, incorrect conclusion. This is because specifying the experimental unit is to specify the independence assumption among units, which is crucially important since it can causes inflated false positive.</p></li>
<li><p><em>(Q5) Are units grouped in any way, such that members of the same group will behave more similarly than members of different groups? (Q6) Do such groups contain equal numbers of units? (Q7) Can units be subdivided, in space or in time, for further treatment comparisons?</em> These questions relate to grouped units, which is less important since we now have highly powerful machines that can store and analyse big data without grouping. Thus, individual subject data are more practical and used more often than it was in the past.</p></li>
</ol>
<p><strong>THE TREATMENTS</strong></p>
<ol start="5" type="1">
<li><em>(Q8) How are proposed treatments structured? (Q9) How rigid are requirements for treatments?</em> In the role of a statistician or bio-statistician, this question is less important for us since it should be considered by experts in the area since it requires great expertise in the field where the study is undertaken. Structuring interventions requires a depth understanding in application, i.e.&nbsp;how to use the drug to treat patients; otherwise, treatments structured are not used in practice and become unrealistic.</li>
</ol>
<p><strong>RANDOMIZATION</strong></p>
<ol start="6" type="1">
<li><em>(Q10) Are there any constraints on random allocation of treatments to units?</em> Although this question was limited in experimental designs, it is an important question, and we should consider as randomization strongly affect the bias of the statistical result. Thus, randomization need to be considered carefully based on different scenarios. in any case, once the randomization is violated, more statistical approaches need to be contemplated to improve the bias.</li>
</ol>
<p><strong>AIMS</strong></p>
<ol start="7" type="1">
<li><em>(Q12) What variates are to be measured? (Q13) What variates are to be analysed?</em> Again, these questions are discussed with experts in the field since whether the effectiveness depends on one or multiple variates requires the vast knowledge in the field. As the role of (bio)statistician this question should not be considered based only on statistical knowledge.</li>
</ol>
<p><strong>PRECISION</strong></p>
<ol start="8" type="1">
<li><p><em>(Q14) How precise ought results to be?</em> This question is important and should be considered by statisticians. As the main issue of any statistical analysis, variance and bias are two metrics that requires to be considered endlessly once we conduct statistical analyses.</p></li>
<li><p><em>(Q15) What is known of variability between units?</em> This question should be considered to choose the experimental unit and assess the independence assumption.</p></li>
<li><p><em>(Q16) Can any concomitant be usefully measured or recorded? (Q17) Is the experiment isolated or one of a series?</em> These are also important questions since it affects the bias of the result.</p></li>
<li><p><em>(Q18) What resources can be used? (Q19) Are there any time constraints? (Q20) Is there any place for planned sequential design?</em> These three questions are important and should be considered carefully since it ensures the study proceed successfully and guarantee the quality and accurate of the final result.</p></li>
<li><p><em>(Q21) How are results to be recorded? (Q22) What arrangements are needed now for subsequent analysis?</em> These two question are not important since we now have modern machine that can solve these issues with ease.</p></li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Are there any questions you would add to this paper now, to reflect more modern statistics?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The first question that we should consider, when the objective question pertains to causal effect, relates to measuring confounding between two groups. I.e., the evaluation of dissimilarity between populations that we compare; also, we need to consider whether the method that we employ to address the dissimilarity problem work effectively and how we evaluate the used method.</p>
<p>When we analyse the data using the Bayesian framework, the evaluation of the knowledge captured in the priors is an important question. This knowledge has to reflect correctly the belief we assign to the treatment efficacy before observing data. Otherwise, we will face a common question in the Bayesian framework, which is ``if your priors are good enough, why do you need the data?‚Äù</p>
<p>The question that ``Do we employ Frequentist of Bayesian paradigm to analyse the data?‚Äù is now worth considering since Bayesian framework is becoming more popular.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How does Finney‚Äôs view of the questioning statistician mesh with (or not) the modern theory of causal inference?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The paper focused on the design of experiments but causal inference. However, the author mentioned a few points that we still have to consider in causal inference. The first one relate to randomization and non-randomization data. Most of the problems arise in observational data are caused by non-randomization. Thus, considering this problem is still available. The second point is about variates we need to consider as the confounding in the causal inference. The third one is about precision of the results that is important in all kinds of data analysis including causal inference. The forth one is about the aim of the the study, here, we need to determine our goal is to draw the association or causation.</p>
</div>
</div>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vandenbroucke refers to the ``restricted potential outcomes approach‚Äù (RPOA). Describe the RPOA, and compare and contrast it to what we discussed in class with regard to causal inference.
</div>
</div>
<div class="callout-body-container callout-body">
<p>RPOA may be employed in two senses, namely technical and philosophical senses. The former concerns a set of mathematical methods and does not imply particular philosophical commitment while the latter involves a restrictive set of convictions about how does causality should be thought of. In other words, RPOA does not aim to pose or answer causal questions as a universal philosophical analysis, but the usefulness of causality that epidemiologists can have. Causality is then useful in the predictive value of causal claims relative to specified interventions. it, therefore, is appealing due to the possibility of prediction under hypothetical scenarios and restricting our attention to causal claims that clearly specify such hypothetical scenarios. We now can characterize the RPOA as follows</p>
<ol type="a">
<li>Causal claims allow prediction under hypothetical scenarios if they are well defined.</li>
<li>Causal claims and questions are well defined when interventions are well specified.</li>
<li>Epidemiologists should restrict their attention to well-defined causal hypotheses, whose hallmark is well-defined interventions.</li>
<li>Except for randomization, observational studies should emulate all aspects of experimental studies because doing so restricts observational studies to investigating well-defined causal hypotheses</li>
</ol>
<p>The key difference between <strong>R</strong>POA and POA are the <strong>Restriction</strong> within potential human intervention, i.e.&nbsp;interventions or manipulation must be humanly feasible manipulations. Thus, a commitment to humanly feasible interventionism is part of the RPOA in epidemiology. Another difference is that RPOA denies the meaningfulness and usefulness of causal claims that do not readily yield predictions under hypothetical scenarios.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Describe the alternative made by Vandenbroucke et al to the RPOA
</div>
</div>
<div class="callout-body-container callout-body">
<p>The authors recommend a pluralistic approach regarding causal concepts. Thus, we should recognize that the causality can be thought in multiple ways, and we should utilize the approach that seems most apt for the epidemiological problem at hand. In short, it is very plausible that we think about causation in more than one way, and we should keep an open mind as to what exactly the nature of causality is. We then work with whatever concept seems most useful from whatever philosophical theories they encounter. Note also that, in epidemiology, taking a strong philosophical position about the nature of causation is not necessary or useful.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The authors state,11A consequence of the view by Glymour and Glymour is that ```states‚Äô like hypertension, hypercholesterolemia, or diabetes can be studied as causes‚Äù. Can you propose a study to assess the causal effect of hypertension on mortality?
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>``Impact of hypertension diagnosis on morbidity and mortality: a retrospective cohort study in primary care‚Äù <span class="citation" data-cites="martin2023impact">[<a href="#ref-martin2023impact" role="doc-biblioref">1</a>]</span></li>
<li>``Blood pressure is the most important cause of death and disability in the world‚Äù <span class="citation" data-cites="he2007blood">[<a href="#ref-he2007blood" role="doc-biblioref">2</a>]</span></li>
</ol>
</div>
</div>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3</h2>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section">3.1</h3>
<p>Note that <span class="math inline">\(\mu\)</span> is unknown.</p>
<p><strong>Using the exact distribution</strong></p>
<p>Since <span class="math inline">\(Y_i \sim N(\mu,\sigma^2)\)</span>, we have</p>
<p><span class="math display">\[
\frac{(n-1)S^2}{\sigma^2} \sim \chi^2_{n-1}, \quad\text{where } S^2 = \frac{1}{n-1}\sum_{i=1}^n(Y_i-\overline Y)^2
\]</span></p>
<p>Thus,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;P\bigg(F_{\chi^2_{n-1}}^{-1}(\alpha/2) &lt;\frac{(n-1)S^2}{\sigma^2} &lt; F_{\chi^2_{n-1}}^{-1}(1-\alpha/2)\bigg) = 1-\alpha \\
\Rightarrow&amp; P\bigg(\frac{(n-1)S^2}{\sigma^2F_{\chi^2_{n-1}}^{-1}(1-\alpha/2)}  &lt;\sigma^2 &lt; \frac{(n-1)S^2}{\sigma^2F_{\chi^2_{n-1}}^{-1}(\alpha/2)}\bigg) = 1-\alpha
\end{aligned}
\]</span></p>
<p><strong>Using convergent distribution</strong></p>
<p>We have</p>
<p><span class="math display">\[
\widehat\sigma^2_{MLE} = \frac{1}{n}\sum_{i=1}^n(Y_i - \overline Y)^2 = \frac{\sum_{i=1}^nY_i^2}{n} - \overline{Y}^2
\]</span></p>
<p>By WLLN, we have <span class="math inline">\(\overline{Y^2} \stackrel{p}{\to} \mu_2\)</span>, which is the second moment. Also, <span class="math inline">\(\overline Y \stackrel{p}{\to} \mu\)</span>, and by the continuous mapping theorem we have <span class="math inline">\(\overline{Y}^2 \stackrel{p}{\to}\mu^2\)</span>. We again apply the continuous mapping theorem for the function <span class="math inline">\(g(a,b) = a-b\)</span> <span class="math inline">\(\widehat{\sigma}^2_{MLE} = \overline{Y^2} - \overline{Y}^2 \stackrel{p}{\to} \mu_2 - \mu^2 = \sigma^2\)</span>.</p>
<p>By asymptotic normality of MLE we have</p>
<p><span class="math display">\[
\sqrt{n} (\widehat{\sigma}^2_{MLE} - \sigma^2) \stackrel{d}{\to} N\Big(0, \frac{1}{\mathcal{I}(\sigma^2)}\Big),
\]</span></p>
<p>where <span class="math inline">\(\mathcal{I}(\sigma^2) = 1/2\sigma^4\)</span>, so</p>
<p><span id="eq-1"><span class="math display">\[
\sqrt{n} (\widehat{\sigma}^2_{MLE} - \sigma^2) \stackrel{d}{\to} N(0, 2\sigma^4),
\tag{1}\]</span></span></p>
<p>We have <span class="math inline">\(\sqrt{n}Var(\widehat{\sigma}^2_{MLE}) = 2\sigma^4\)</span>. Using stabilizing transformation we have</p>
<p><span class="math display">\[
\phi(\sigma^2) = \int\frac{c}{\sigma^2\sqrt{2}}d\sigma^2 = \frac{c}{\sqrt{2}}\ln\sigma^2
\]</span></p>
<p>We choose <span class="math inline">\(c = \sqrt{2}\)</span>. Thus <span class="math inline">\(\phi(\sigma^2) = \ln(\sigma^2)\)</span>. Now, by delta method we have</p>
<p><span class="math display">\[
Var[\log(\widehat{\sigma}^2_{MLE})] = (1/\widehat{\sigma}^2_{MLE})^2|_{\widehat{\sigma}^2_{MLE} = \sigma^2}Var(\widehat{\sigma}^2_{MLE}) = 2
\]</span> Thus,</p>
<p><span class="math display">\[
\sqrt{n/2}[\log(\widehat{\sigma}^2_{MLE}) - \log(\sigma^2)] \stackrel{d}{\to} N(0,1)
\]</span></p>
<p>The CI is then</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\Phi^{-1}(\alpha/2) &lt; \sqrt{n/2}[\log(\widehat{\sigma}^2_{MLE}) - \log(\sigma^2)] &lt; \Phi^{-1}(1-\alpha/2)\\
\Rightarrow &amp; \frac{\Phi^{-1}(\alpha/2)}{\sqrt{n/2}} &lt; \log(\widehat{\sigma}^2_{MLE}) - \log(\sigma^2) &lt; \frac{\Phi^{-1}(1-\alpha/2)}{\sqrt{n/2}}\\
\Rightarrow &amp; \log(\widehat{\sigma}^2_{MLE}) - \frac{\Phi^{-1}(1-\alpha/2)}{\sqrt{n/2}}  &lt; \log(\sigma^2) &lt; \log(\widehat{\sigma}^2_{MLE}) - \frac{\Phi^{-1}(\alpha/2)}{\sqrt{n/2}} \\
\Rightarrow &amp;\exp\bigg\{\log(\widehat{\sigma}^2_{MLE}) - \frac{\Phi^{-1}(1-\alpha/2)}{\sqrt{n/2}}\bigg\} &lt; \sigma^2 &lt; \exp\bigg\{\log(\widehat{\sigma}^2_{MLE}) - \frac{\Phi^{-1}(\alpha/2)}{\sqrt{n/2}} \bigg\}
\end{aligned}
\]</span></p>
<p>Alternatively, we don‚Äôt need to use the stabilizing transformation since <a href="#eq-1">Equation&nbsp;1</a> can be written as</p>
<p><span class="math display">\[
\sqrt{n/2}\bigg(\frac{\widehat{\sigma}^2_{MLE}}{\sigma^2} -1\bigg) \stackrel{d}{\to} N(0,1)
\]</span> So</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\Phi^{-1}(\alpha/2) \sqrt{2/n}+1&lt;\frac{\widehat{\sigma}^2_{MLE}}{\sigma^2} &lt; \Phi^{-1}(1-\alpha/2)\sqrt{2/n}+1 \\
\Rightarrow &amp;\frac{\widehat{\sigma}^2_{MLE}}{\Phi^{-1}(1-\alpha/2)\sqrt{2/n}+1}  &lt; \sigma^2 &lt; \frac{\widehat{\sigma}^2_{MLE}}{\Phi^{-1}(\alpha/2) \sqrt{2/n}+1}
\end{aligned}
\]</span></p>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1">3.2</h3>
<p><strong>(a)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="dv">61</span><span class="sc">/</span><span class="dv">350</span>; p2 <span class="ot">=</span> <span class="dv">77</span><span class="sc">/</span><span class="dv">350</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">-</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.04571429</code></pre>
</div>
</div>
<p>We check the result using the IPD</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">350</span>, <span class="dv">350</span>))<span class="sc">|&gt;</span> <span class="fu">as.factor</span>(); </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">273</span>, <span class="dv">77</span>, <span class="dv">289</span>, <span class="dv">61</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y,<span class="at">x =</span> x)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>model01 <span class="ot">=</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">family =</span> binomial, <span class="at">data =</span> d)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>p1_mod <span class="ot">=</span>  <span class="fu">predict</span>(model01, <span class="fu">data.frame</span>(<span class="at">x =</span> x[x <span class="sc">==</span><span class="dv">1</span>]), <span class="st">"response"</span>)<span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>p2_mod <span class="ot">=</span> <span class="fu">predict</span>(model01, <span class="fu">data.frame</span>(<span class="at">x =</span> x[x <span class="sc">==</span><span class="dv">0</span>]), <span class="st">"response"</span>)<span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>p1_mod <span class="sc">-</span> p2_mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.04571429</code></pre>
</div>
</div>
<p><strong>(b)</strong></p>
<p><em>Direct standardization</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>p1a <span class="ot">=</span> <span class="dv">36</span><span class="sc">/</span><span class="dv">270</span>; p2a <span class="ot">=</span> <span class="dv">6</span><span class="sc">/</span><span class="dv">87</span>; </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>p1b <span class="ot">=</span> <span class="dv">25</span><span class="sc">/</span><span class="dv">80</span>; p2b <span class="ot">=</span> <span class="dv">71</span><span class="sc">/</span><span class="dv">263</span>;</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>p1a<span class="sc">*</span><span class="fl">0.5</span> <span class="sc">+</span> p1b<span class="sc">*</span><span class="fl">0.5</span> <span class="sc">-</span> p2a<span class="sc">*</span><span class="fl">0.5</span> <span class="sc">-</span> p2b<span class="sc">*</span><span class="fl">0.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05345292</code></pre>
</div>
</div>
<p><em>IPTW</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#keyhole</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="dv">270</span><span class="sc">/</span><span class="dv">357</span>; p2 <span class="ot">=</span> <span class="dv">80</span><span class="sc">/</span><span class="dv">343</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>r_key <span class="ot">=</span> (<span class="dv">36</span><span class="sc">/</span>p1 <span class="sc">+</span> <span class="dv">25</span><span class="sc">/</span>p2)<span class="sc">/</span>(<span class="dv">357</span><span class="sc">+</span><span class="dv">343</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#open</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="dv">87</span><span class="sc">/</span><span class="dv">357</span>; p2 <span class="ot">=</span> <span class="dv">263</span><span class="sc">/</span><span class="dv">343</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>r_open <span class="ot">=</span> (<span class="dv">6</span><span class="sc">/</span>p1 <span class="sc">+</span> <span class="dv">71</span><span class="sc">/</span>p2)<span class="sc">/</span>(<span class="dv">357</span><span class="sc">+</span><span class="dv">343</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># absolute risk</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>r_key <span class="sc">-</span> r_open</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05367122</code></pre>
</div>
</div>
<p>Let us check the result using IPD</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>open <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">81</span>,<span class="dv">6</span>,<span class="dv">192</span>,<span class="dv">71</span>));</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>w_open <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">87</span><span class="sc">/</span><span class="dv">357</span>), <span class="dv">1</span><span class="sc">/</span>(<span class="dv">263</span><span class="sc">/</span><span class="dv">343</span>)), <span class="fu">c</span>(<span class="dv">87</span>, <span class="dv">263</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>keyhole <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">234</span>,<span class="dv">36</span>,<span class="dv">55</span>,<span class="dv">25</span>)); </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>w_keyhole <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">270</span><span class="sc">/</span><span class="dv">357</span>), <span class="dv">1</span><span class="sc">/</span>(<span class="dv">80</span><span class="sc">/</span><span class="dv">343</span>)), <span class="fu">c</span>(<span class="dv">270</span>, <span class="dv">80</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>out1 <span class="ot">=</span> <span class="fu">glm</span>(open <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">weights =</span> w_open)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>out2 <span class="ot">=</span> <span class="fu">glm</span>(keyhole <span class="sc">~</span><span class="dv">1</span>, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">weights =</span> w_keyhole)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>r_open_mod <span class="ot">=</span> boot<span class="sc">::</span><span class="fu">inv.logit</span>(out1<span class="sc">$</span>coefficients)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>r_key_mod<span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">inv.logit</span>(out2<span class="sc">$</span>coefficients)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>r_key_mod <span class="sc">-</span> r_open_mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
 0.05367122 </code></pre>
</div>
</div>
<p><strong>(c)</strong></p>
<p><em>Direct standardization</em></p>
<p>Suppose the risk difference is <span class="math inline">\(RD = p_1 - p_0\)</span>, then <span class="math inline">\(V(RD) = V(p_1) + V(p_0)\)</span>, where <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_0\)</span> are risk of open and keyhole surgery, respectively. Note that</p>
<p><span class="math display">\[
p_i = 0.5p_{ij} + 0.5p_{ij}, \quad (i = 0,1)
\]</span></p>
<p>where <span class="math inline">\(j = 1,2\)</span> indicates the size of kidney stone. Thus</p>
<p><span class="math display">\[
V(p_i) = 0.25V(p_{ij}) + 0.25V(p_{ij})
\]</span></p>
<p>and <span class="math inline">\(V(p_{ij}) = \frac{p_{ij}(1-p_{ij})}{n_j}\)</span>.</p>
<p><em>IPTW</em></p>
<p>The idea is to use the <em>bootstrap</em> or <em>Robust Sandwich Estimator</em>. For the shake of simplicity, we translate the contingency tables to individual participant data (IPD). Here we can either do bootstrap manually using the IPD or fit the model using <code>glm</code> in R, and we then use the package <code>sandwich</code> to specify the bootstrap or robust estimate.</p>
<p>Note that functions in the package require the object of <code>glm</code> and return the variance of <span class="math inline">\(\eta = \log(\frac{p}{1-p})\)</span>. However, the variance of <span class="math inline">\(p\)</span> can be specified using the delta method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(out1); sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(out2) <span class="do">### robust</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">##             (Intercept)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  0.02129039</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">##             (Intercept)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  0.02687997</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>sandwich<span class="sc">::</span><span class="fu">vcovBS</span>(out1); sandwich<span class="sc">::</span><span class="fu">vcovBS</span>(out1) <span class="do">### bootstrap</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="do">##             (Intercept)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  0.02213511</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="do">##             (Intercept)</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  0.02203835</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="do">## check </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out1)<span class="sc">$</span>cov.unscaled; <span class="fu">summary</span>(out2)<span class="sc">$</span>cov.unscaled <span class="do">### from model</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="do">##             (Intercept)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  0.01024681</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="do">##             (Intercept)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) 0.008294616</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that if <span class="math inline">\(\eta = \log(\frac{p}{1-p})\)</span>, then <span class="math inline">\(p = \frac{\exp(\eta)}{1+\exp(\eta)}\)</span>. We can then obtain the variance of <span class="math inline">\(p\)</span> using the Delta method. Finally, we calculate the variance of risk difference which is <span class="math inline">\(V(RD) = V(p_1) + V(p_2)\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pDot <span class="ot">=</span> \(x) <span class="fu">exp</span>(x)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(x))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>vl1 <span class="ot">=</span> sandwich<span class="sc">::</span><span class="fu">vcovHAC</span>(out1); vl2 <span class="ot">=</span> sandwich<span class="sc">::</span><span class="fu">vcovHAC</span>(out1)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">=</span> <span class="fu">pDot</span>(out1<span class="sc">$</span>coefficients)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>vl1</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">=</span> <span class="fu">pDot</span>(out2<span class="sc">$</span>coefficients)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>vl2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variance of RD is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>v1 <span class="sc">+</span> v2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            (Intercept)
(Intercept)  0.02643717</code></pre>
</div>
</div>
<!-- # Question 3 -->
<!-- ```{r} -->
<!-- NHANES$SmokeNow <- as.numeric(NHANES$SmokeNow)-1 -->
<!-- small.nhanes <- na.omit(NHANES[NHANES$SurveyYr=="2011_12" & -->
<!-- NHANES$Age > 17,c(3,4,8:11,13,25,61)]) -->
<!-- # dim(small.nhanes) ## 1377 -->
<!-- ``` -->
<!-- ## 1. -->
<!-- ```{r} -->
<!-- vars = names(small.nhanes)|> {\(i) i[! i %in% c("BPSysAve", "SmokeNow")] }() -->

<!-- tabUnmatched <- CreateTableOne(vars = vars, strata = "SmokeNow", data = small.nhanes, -->
<!--                                test = FALSE) -->
<!-- print(tabUnmatched, smd = TRUE) -->
<!-- ``` -->
<!-- ## 2. -->
<!-- We estimate the propensity score using the logistic model: -->
<!-- ```{r} -->
<!-- psModel = glm(SmokeNow ~ Gender + Age +Race3 + Education + MaritalStatus + -->
<!--                 HHIncome + Poverty, family = binomial(link = "logit"),  -->
<!--               data = small.nhanes) -->
<!-- small.nhanes$ps<- predict(psModel, type = "response") -->
<!-- ``` -->
<!-- We stratify the data based on the estimated propensity score using quintiles: -->
<!-- ```{r} -->
<!-- quintiles <-  -->
<!--   quantile(small.nhanes$ps, prob = seq(from = 0,to = 1, by = 0.2), na.rm = T) -->
<!-- small.nhanes$ps.stratify <-  -->
<!--   cut(small.nhanes$ps, breaks = quintiles, labels = LETTERS[1:5], include.lowest = T) -->
<!-- ``` -->
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="references" class="level2 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" role="list">
<div id="ref-martin2023impact" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Martƒ±ÃÅn-Fern√°ndez J, Alonso-Safont T, Polentinos-Castro E, Esteban-Vasallo MD, Ariza-Cardiel G, Gonz√°lez-Anglada MI, et al. Impact of hypertension diagnosis on morbidity and mortality: A retrospective cohort study in primary care. BMC primary care. 2023;24(1):79. </div>
</div>
<div id="ref-he2007blood" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">He FJ, MacGregor GA. Blood pressure is the most important cause of death and disability in the world. European heart journal supplements. 2007;9(suppl_B):B23‚Äì8. </div>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>